
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Asymmetric Encryption &#8212; Python Security</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/justify.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/analytics_gtag.js"></script>
    <script src="../_static/analytics.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://elc.github.com/python-security/chapters/07_Asymmetric_Encryption.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Input Sanitization - Under Construction" href="08_Input_Sanitization.html" />
    <link rel="prev" title="Symmetric Encryption" href="06_Symmetric_Encryption.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Python Security</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="00_Fundamentals.html">
                    Introduction to Security
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Hashes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_Hash_Introduction.html">
   Hash Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_Salt.html">
   Salt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_Pepper.html">
   Pepper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_Checksum.html">
   Checksum
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_HMAC.html">
   HMAC
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Encryption
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="06_Symmetric_Encryption.html">
   Symmetric Encryption
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Asymmetric Encryption
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Threats
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="08_Input_Sanitization.html">
   Input Sanitization - Under Construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_Common_Threats.html">
   Common Threats - Under Construction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Applications
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="10_JSON_Web_Tokens.html">
   JSON Web Tokens (JWT)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="19_Blockchain.html">
   BlockChain - Under Construction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Additional Material
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="80_Additional_Resources.html">
   Additional Resources
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="91_Bytes.html">
   Bytes Data Type
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="92_Base64.html">
   Base64 Encoding
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/ELC/python-security/source?urlpath=tree/chapters/07_Asymmetric_Encryption.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/ELC/python-security/blob/source/chapters/07_Asymmetric_Encryption.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ELC/python-security"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ELC/python-security/edit/source/chapters/07_Asymmetric_Encryption.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/chapters/07_Asymmetric_Encryption.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#public-key-encryption-digital-signature">
   Public Key Encryption != Digital Signature
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#public-key-encryption-certificate-based-communication">
   Public Key Encryption != Certificate Based Communication
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-usage-for-certificates">
     Other usage for Certificates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practical-example">
     Practical Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-certificates-implementation-considerations">
     Using Certificates - Implementation Considerations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#caveats-of-public-key-encryption">
   Caveats of Public Key Encryption
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rsa-encryption">
   RSA Encryption
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generating-keys">
     Generating Keys
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#encrypting">
     Encrypting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decrypting">
     Decrypting
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-unlinked-private-key">
       Using unlinked Private Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-unlinked-public-key">
       Using unlinked Public Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-original-private-key">
       Using original Private Key
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#signing-message">
     Signing Message
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verifying-signature">
     Verifying Signature
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tampered-message">
       Tampered Message
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tampered-message-and-signature">
       Tampered Message and Signature
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#unliked-public-key">
       Unliked Public Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#original-message-signature-and-public-key">
       Original Message, Signature and Public Key
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-pem-files">
   Using PEM Files
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#storing-the-keys-as-pem-files">
     Storing the Keys as PEM Files
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#saving-private-key">
       Saving Private Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#saving-public-key">
       Saving Public Key
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-pem-files">
     Loading PEM Files
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wrong-password">
       Wrong Password
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#right-password">
       Right Password
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#encryption-and-decryption-using-pem-files">
     Encryption and Decryption using PEM Files
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Encrypting
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Decrypting
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#digital-signature-using-pem-files">
     Digital Signature using PEM Files
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#signing-a-message">
       Signing a Message
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Verifying Signature
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Asymmetric Encryption</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#public-key-encryption-digital-signature">
   Public Key Encryption != Digital Signature
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#public-key-encryption-certificate-based-communication">
   Public Key Encryption != Certificate Based Communication
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-usage-for-certificates">
     Other usage for Certificates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practical-example">
     Practical Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-certificates-implementation-considerations">
     Using Certificates - Implementation Considerations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#caveats-of-public-key-encryption">
   Caveats of Public Key Encryption
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rsa-encryption">
   RSA Encryption
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generating-keys">
     Generating Keys
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#encrypting">
     Encrypting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decrypting">
     Decrypting
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-unlinked-private-key">
       Using unlinked Private Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-unlinked-public-key">
       Using unlinked Public Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-original-private-key">
       Using original Private Key
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#signing-message">
     Signing Message
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verifying-signature">
     Verifying Signature
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tampered-message">
       Tampered Message
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tampered-message-and-signature">
       Tampered Message and Signature
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#unliked-public-key">
       Unliked Public Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#original-message-signature-and-public-key">
       Original Message, Signature and Public Key
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-pem-files">
   Using PEM Files
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#storing-the-keys-as-pem-files">
     Storing the Keys as PEM Files
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#saving-private-key">
       Saving Private Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#saving-public-key">
       Saving Public Key
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-pem-files">
     Loading PEM Files
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wrong-password">
       Wrong Password
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#right-password">
       Right Password
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#encryption-and-decryption-using-pem-files">
     Encryption and Decryption using PEM Files
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Encrypting
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Decrypting
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#digital-signature-using-pem-files">
     Digital Signature using PEM Files
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#signing-a-message">
       Signing a Message
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Verifying Signature
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="asymmetric-encryption">
<h1>Asymmetric Encryption<a class="headerlink" href="#asymmetric-encryption" title="Permalink to this headline">#</a></h1>
<p><strong>ToDo</strong>:</p>
<ul class="simple">
<li><p>Add illustration for Asymmetric Encryption - Similar to <a class="reference external" href="https://lh3.googleusercontent.com/proxy/dCTxllT1M9nTQYlyzWcAG-svygYYNiFpD29S4s_rfdfiDAMF20YPOKR8hkoQmqx1kWPBHHnnxP5_uwYEL4Hgt4tmka6a-LfI80w">this</a> and <a class="reference external" href="http://scientopia.org/img-archive/goodmath/img_340.png">this</a>.</p></li>
<li><p>Add illustration for digital signature - Similar to <a class="reference external" href="http://www.zytrax.com/tech/survival/signature.png">this</a> and <a class="reference external" href="https://www.researchgate.net/publication/339696424/figure/fig1/AS:865416696057857&#64;1583342827835/A-Bitcoin-digital-signature-diagram.png">this</a> and <a class="reference external" href="https://blog.mailfence.com/wp-content/uploads/2016/12/800px-Digital_Signature_diagram.svg.png">this</a></p></li>
<li><p>Explain the SSL Handshake - Similar to <a class="reference external" href="https://www.101computing.net/wp/wp-content/uploads/SSL-Handshake.png">this</a></p></li>
<li><p>Add appendix using <code class="docutils literal notranslate"><span class="pre">requests</span></code> to show self-signed warnings.</p></li>
<li><p>Add relevant resources at the end.</p></li>
</ul>
<hr class="docutils" />
<p>Asymmetric encryption does not have passwords or keys like symmetric but rather it splits the security into a pair of keys, one used to encrypt (usually called Public Key) and another used to decrypt (usually call Private Key). As the name implies one can be shared publicly and the other should be kept secret. This method is also known as <a class="reference external" href="https://en.wikipedia.org/wiki/Public-key_cryptography"><strong>Public-key cryptography</strong></a>.</p>
<p>The keys are sequences of bytes generated together and are mathematically linked, they are also called “Key Pair”. Each party in the communication should have its own key pair and have their Public Keys shared. This means that there is no need for a “secure channel” to exchange keys as in symmetric encryption since the Public key are by design sharable.</p>
<p>This type of encryption is used nowadays in many applications, ranging from the commonplace SSH protocol to the trendy Bitcoin transactions.</p>
<p>A party can generate as many Key Pairs as needed, meaning that, in case of a Private Key being compromised, a new Key Pair can be generated.</p>
<section id="public-key-encryption-digital-signature">
<h2>Public Key Encryption != Digital Signature<a class="headerlink" href="#public-key-encryption-digital-signature" title="Permalink to this headline">#</a></h2>
<p>The idea of a <a class="reference external" href="https://en.wikipedia.org/wiki/Digital_signature">Digital Signature</a> is basically reversing Public Key Encryption, that is, instead of encrypting messages that only the holder of the Private Key can decrypt, a message is encrypted with the Private Key so that everyone else can decrypt it using the Public Key. In this case, even though the message is encrypted, the word <strong>signature</strong> is used to represent that it is no secret. The signature itself has the same format as an encrypted message, it is a sequence of bytes.</p>
<p>This scheme does not provide <strong>privacy</strong>, since everyone can decrypt the signature, but it provides <strong>Authentication</strong> (Only the holder of the Private Key could have signed this message) and in some context also legal <strong>Non-Repudiation</strong>. Some countries consider that digitally signed files/messages are subject to non-repudiation.</p>
<p>The Key Pair is exactly the the same as the one used in Public Key Encryption, however the terminology changes to avoid confusion. If Public Key Encryption is an asymmetric analog as symmetric encryption, digital signatures can be thought of as an asymmetric analog of HMACs.</p>
</section>
<section id="public-key-encryption-certificate-based-communication">
<h2>Public Key Encryption != Certificate Based Communication<a class="headerlink" href="#public-key-encryption-certificate-based-communication" title="Permalink to this headline">#</a></h2>
<p>One way to implement Public Key Encryption is through <a class="reference external" href="https://en.wikipedia.org/wiki/Public_key_certificate"><strong>Certificates</strong></a>, a certificate is something bigger in scope than the Key Pair because the Key Pair is simply two sequences of bytes whereas the certificate includes not only the public key but also information about the algorithm, versioning, subject and issuer information and so on.</p>
<p>Therefore, a Key Pair is enough to encrypt and decrypt but a certificate has metadata and additional information to establish a <strong>secure channel of communication</strong>. One of the most widely used algorithms for Public Key Encryption is <a class="reference external" href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)"><code class="docutils literal notranslate"><span class="pre">RSA</span></code></a> and the current standard for certificate is <a class="reference external" href="https://en.wikipedia.org/wiki/X.509"><code class="docutils literal notranslate"><span class="pre">X.509</span></code></a> (which uses RSA Public Key Encryption). Certificate based communication is used in most website, the key indicator is the use of TLS, more commonly reflected by the use of HTTPS (instead of HTTP).</p>
<p>Some of the information a certificate contains is:</p>
<ul class="simple">
<li><p>Information about the <strong>identity</strong> (Email, Organization Name, Country, State, <a class="reference external" href="https://en.wikipedia.org/wiki/Certificate_signing_request#Procedure">among others</a>) of who generated the Public Key (the subject).</p></li>
<li><p>A <strong>digital signature</strong> <a class="footnote-reference brackets" href="#id5" id="id1">1</a> that validates the identity information is correct and it corresponds to the subject.</p></li>
</ul>
<p>The drawback of this approach is that nothing impedes an attacker to sign their own certificates, i.e. anyone can claim being anyone else. These are the so-called <a class="reference external" href="https://en.wikipedia.org/wiki/Self-signed_certificate">self-signed certificates</a>. To avoid that, the signature should come from a trusted third party, known as <a class="reference external" href="https://en.wikipedia.org/wiki/Certificate_authority"><strong>Certificate Authority</strong></a>. It needs to be an independent and trusted-by-everyone party that validates the identity of who is generating the Public Key. This is necessary if the subject is unknown or could not be trusted.</p>
<p>When the subject acts as its own CA, generating a self-signed certificate, it triggers warnings in most environments, e.g. most programming libraries will throw validation errors. Web browsers will consider a self-signed certificate to be <strong>insecure</strong>. It is not a matter of security (i.e. the data will be encrypted anyway) but rather a matter of trust, trusting that the received Public Key comes from the intended subject and that there is no other man-in-the-middle.</p>
<p>For debugging and testing, self-signed certificates are usually not a concern, for all other use cases, a certificate signed by a CA should be used.</p>
<p>To get a certificate signed by a CA, one has to submit a <a class="reference external" href="https://en.wikipedia.org/wiki/Certificate_signing_request"><strong>Certificate Signing Request</strong></a>, it normally takes several days and it is usually paid service, they also validate that the identity information corresponds to the one asking for the validation. A CA will not sign certificates to anyone on behalf of anyone else, i.e. I cannot get a CA signing a certificate saying I am Google.</p>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">#</a></h3>
<p>When logging in a service (e.g. email), one enters a username and a password. It is desired that the password travels encrypted through internet, so that no one can read it but the service provider. To encrypt that, certificate based communication is used, the Public Key is used to encrypt the password and then the service provider can use its private key to read it.</p>
<p>That being said, what happens if the Public Key used does not come from the service provider and instead was injected by an attacker’s Key Pair? They would have a corresponding Private Key with which they can see the password (and then if needed redirect to the real service provider).</p>
<p>That is when Certificate Authorities come in, because the certificate will also include a digital signature saying “This is the public key for this service provider”. Attackers can mimic Public Keys from any subject, however, they cannot bypass the digital signature, because everyone can verify if a digital signature comes from a CA or not.</p>
</section>
<section id="other-usage-for-certificates">
<h3>Other usage for Certificates<a class="headerlink" href="#other-usage-for-certificates" title="Permalink to this headline">#</a></h3>
<p>Another usage of certificates is <strong>User Authentication</strong>, in this case one organization can generate specific certificates for each user with all the authentication relevant information. The user can add that certificate to their operating system, and then when making a request only a user id (email, GUID or similar) should be provided.</p>
<p>If the user id matches the information in the certificate and the signature of the certificate is valid (i.e. is was signed by the organization server), the user is consider authenticated and the request is processed.</p>
<p>An example of such authentication mechanism in Flask can be seen in this <a class="reference external" href="https://github.com/ContinuumIO/flask-ssl-authentication">Anaconda Repo</a></p>
</section>
<section id="practical-example">
<h3>Practical Example<a class="headerlink" href="#practical-example" title="Permalink to this headline">#</a></h3>
<p>This particular site has <strong>HTTPS</strong> with a certificate signed by <a class="reference external" href="https://www.digicert.com/">DigiCert</a>, one of many Certificate Authorities.</p>
<center>
<img src="../_static/images/certificate_CA_example.png">
</center>
<p>When opened, some details are shown</p>
<center>
<img src="../_static/images/certificate_details.png">
</center>
<p>However, something might draw special attention, it says “<strong>Issued to</strong>: www.github.com” but the site is <a class="reference external" href="https://elc.github.io/"><strong>elc.github.io</strong></a>. If we inspect the details, we can see that the <strong>Issuer</strong> is the CA, the <strong>Subject</strong> is Github and the there is an special field called <strong>Subject Alternative Name</strong>, there one of the DNS Names is <strong>*.github.io</strong> which is compatible which this site URL. Therefore, the browser knows the certificate is from Github, validated by DigiCert and even though the URL is not Github’s it is under one of the registered alternative names.</p>
<center>
<img src="../_static/images/certificate_details_dns.png">
</center></section>
<section id="using-certificates-implementation-considerations">
<h3>Using Certificates - Implementation Considerations<a class="headerlink" href="#using-certificates-implementation-considerations" title="Permalink to this headline">#</a></h3>
<p>Some times the process of getting a signed certificate might be troublesome or tedious, fortunately there are shortcuts:</p>
<ul class="simple">
<li><p>Using a hosting service that provides HTTPS out of the box (e.g. Github Pages does it freely)</p></li>
<li><p>Outsourcing the certificate request (e.g. Most cloud providers will do that on our behalf)</p></li>
<li><p>Using hosted services (e.g. Azure Web Apps comes with HTTPS support)</p></li>
</ul>
<p>It is usually useful to work in layers, many times one can have a gateway server (Apache, Nginx or similar) that takes care of the TLS connection (certificate based communications) while the underlying application use it seemlessly. Meaning there is no code change needed on the application side.</p>
<p>The following examples will focus on the Public Key Encryption without the CA signing process for simplicity. To implement a certificate signed by a CA, <a class="reference external" href="https://cryptography.io/en/latest/x509/tutorial">follow the official tutorial</a>. However, <strong>unless being supported by a security expert it is always recommended to trust hosted/managed services instead of doing security from scratch</strong>.</p>
</section>
</section>
<section id="caveats-of-public-key-encryption">
<h2>Caveats of Public Key Encryption<a class="headerlink" href="#caveats-of-public-key-encryption" title="Permalink to this headline">#</a></h2>
<p>Asymmetric Encryption is usually much slower than symmetric encryption, that is way in many applications both are used:</p>
<ol class="simple">
<li><p>Both parties exchange their Public Keys.</p></li>
<li><p>The Public Keys are then used to send an encrypted password/key for symmetric encryption.</p></li>
<li><p>All following communication is done encrypted using the symmetric encryption method.</p></li>
</ol>
<p>The particular details of the implementation may vary depending on the specific protocol but generally Asymmetric Encryption is used as the so-called “Secure Channel” to exchange the keys for the symmetric encryption method. Modern HTTPS connections work like this.</p>
</section>
<section id="rsa-encryption">
<h2>RSA Encryption<a class="headerlink" href="#rsa-encryption" title="Permalink to this headline">#</a></h2>
<p>RSA is one of the asymmetric encryption algorithms available in the PyCA cryptography library. The particular objects used here are part of the <code class="docutils literal notranslate"><span class="pre">hazmat</span></code> package, <code class="docutils literal notranslate"><span class="pre">hazmat</span></code> stands for “Hazardous Materials” and quoting from their <a class="reference external" href="https://cryptography.io/en/latest/hazmat/primitives/asymmetric/rsa/">site</a>:</p>
<blockquote>
<div><p>This is a “Hazardous Materials” module. You should ONLY use it if you’re 100% absolutely sure that you know what you’re doing because this module is full of land mines, dragons, and dinosaurs with laser guns.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.asymmetric import rsa, padding
from cryptography.exceptions import InvalidSignature
</pre></div>
</div>
</div>
</div>
<section id="generating-keys">
<h3>Generating Keys<a class="headerlink" href="#generating-keys" title="Permalink to this headline">#</a></h3>
<p>The first step is to generate the private key, for that two parameters are needed the <code class="docutils literal notranslate"><span class="pre">public_exponent</span></code> and the <code class="docutils literal notranslate"><span class="pre">key_size</span></code>. The former should be fixed to <code class="docutils literal notranslate"><span class="pre">65537</span></code> whereas the second can be changed and as per modern security standards it should be at least <code class="docutils literal notranslate"><span class="pre">2048</span></code>. Then the Public Key is generated from the private Key object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def generate_key_pair():
    key_size = 2048  # Should be at least 2048

    private_key = rsa.generate_private_key(
        public_exponent=65537,  # Do not change
        key_size=key_size,
    )

    public_key = private_key.public_key()
    return private_key, public_key
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>private_key, public_key = generate_key_pair()
</pre></div>
</div>
</div>
</div>
</section>
<section id="encrypting">
<h3>Encrypting<a class="headerlink" href="#encrypting" title="Permalink to this headline">#</a></h3>
<p>For the encryption process only the public key is used, no password is needed. The messages encrypted with this Public Key will only be decryptable with the linked Private Key. Moreover, if other messages are encrypted with different Public Keys, they will not be decryptable with the linked Private Key.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def encrypt(message, public_key):
    return public_key.encrypt(
        message,
        padding.OAEP(
            mgf=padding.MGF1(algorithm=hashes.SHA256()),
            algorithm=hashes.SHA256(),
            label=None
        )
    )
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>message = b&quot;Hello World!&quot;

message_encrypted = encrypt(message, public_key)

print(f&quot;Encrypted Text: {message_encrypted.hex()}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Encrypted Text: 0f01e45c304eded2e7c31d2e5b0a378b410d89def4398d9fcef69d6c00d783b32df18c7aa26d4e00acecc95ee2fb82218cac7437ee4dcdd773ff873af5db302dfe7f6b12b6d7d3f23fa61f925b878b31b450746572aeaa3a169e2bdf9eb6f820e7ca0ebb90874f469b19c0280636719f14c885ea6ddf7469384047a6f59f3bd24376588e31aa28067459e53a2e44fc6721fe6a63cb59d7621c6c045990aa9a42bd4756740ee116ae40680e2593109d5748d6c35a246485e36bf282bab35bddc9aa2d427700e1d7f52867d28034b7ba43c00777368571fc79b89a3df807dd9790c29bbee858e7030e78d63b6c3147aad4ddffc32fc5a01bd81082a23526158b6a
</pre></div>
</div>
</div>
</div>
</section>
<section id="decrypting">
<h3>Decrypting<a class="headerlink" href="#decrypting" title="Permalink to this headline">#</a></h3>
<p>Auxiliary Function to decrypt an encrypted message and returning a string message.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def decrypt(message_encrypted, private_key):
    try:
        message_decrypted = private_key.decrypt(
            message_encrypted,
            padding.OAEP(
                mgf=padding.MGF1(algorithm=hashes.SHA256()),
                algorithm=hashes.SHA256(),
                label=None
            )
        )
        return f&quot;Decrypted Message: {message_decrypted}&quot;
    except ValueError:
        return &quot;Failed to Decrypt&quot;
</pre></div>
</div>
</div>
</div>
<section id="using-unlinked-private-key">
<h4>Using unlinked Private Key<a class="headerlink" href="#using-unlinked-private-key" title="Permalink to this headline">#</a></h4>
<p>If other <strong>Private Key</strong> different from the one of the original Key Pair is used, the decryption will fail.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>private_key_other, _ = generate_key_pair()

message_decrypted = decrypt(message_encrypted, private_key_other)
print(message_decrypted)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Failed to Decrypt
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-unlinked-public-key">
<h4>Using unlinked Public Key<a class="headerlink" href="#using-unlinked-public-key" title="Permalink to this headline">#</a></h4>
<p>If other <strong>Public Key</strong> different from the one of the original Key Pair is used, the decryption will fail.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>_, public_key_other = generate_key_pair()

message_encrypted_other = encrypt(message, public_key_other)

message_decrypted = decrypt(message_encrypted_other, private_key)
print(message_decrypted)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Failed to Decrypt
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-original-private-key">
<h4>Using original Private Key<a class="headerlink" href="#using-original-private-key" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>message_decrypted = decrypt(message_encrypted, private_key)
print(message_decrypted)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Decrypted Message: b&#39;Hello World!&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="signing-message">
<h3>Signing Message<a class="headerlink" href="#signing-message" title="Permalink to this headline">#</a></h3>
<p>To use the Key Pair for Digital Signature, the Private Key is used for encryption. In this case the method is called <code class="docutils literal notranslate"><span class="pre">sign</span></code> and not <code class="docutils literal notranslate"><span class="pre">encrypt</span></code> to have consistent terminology and avoid confusion.</p>
<p>A pair (message, signature) will only be valid if the message, the signature and the public key are the original ones, if any of those gets modified, an error will be thrown.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def sign(message, private_key):
    return private_key.sign(
        message,
        padding.PSS(
            mgf=padding.MGF1(hashes.SHA256()),
            salt_length=padding.PSS.MAX_LENGTH
        ),
        hashes.SHA256()
    )
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>message = b&quot;My website is http://elc.github.io&quot;

signature = sign(message, private_key)

print(f&quot;Digital Signature: {signature.hex()}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Digital Signature: ae7609815b5ff959aac2f86addeb4eef717cc2b4455d7fd73e8433224f52ecbbcbb527a0dcb73028f9905c9dcf58a866977f7956d571896f1d15729652f2ae9a331d9f61d395d927e8cd563c231aa1456238acad48f18d102f6c7eb20dd1523c63b94b9d7b395d65585159615acff15500916ded87198e250dc8473ca59eebaa8084472fb6e5630b6f808d260c8b5739ebbc87daf92137eae71f0b2c570115da5feeecf0dc5ed6bd2efe88f3c22d411fc49b4571fb9bbab3b86d0430285dcc933421a0c66f66c49592b23dac523052404a5baf93984dc38cc07cb0af575f4a904e4bcbcfb508e0e182d866d38b06b18f5c842124c9889478fce72982703353b5
</pre></div>
</div>
</div>
</div>
</section>
<section id="verifying-signature">
<h3>Verifying Signature<a class="headerlink" href="#verifying-signature" title="Permalink to this headline">#</a></h3>
<p>This is a helper function to avoid code duplication, it will return a string message depending on whether the message, signature pair is valid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def verify(signature, message, public_key):
    try:
        public_key.verify(
            signature,
            message,
            padding.PSS(
                mgf=padding.MGF1(hashes.SHA256()),
                salt_length=padding.PSS.MAX_LENGTH
            ),
            hashes.SHA256()
        )
        return &quot;The message has been successfully verified&quot;
    except InvalidSignature:
        return &quot;The signature, the message or the Public Key is invalid&quot;
</pre></div>
</div>
</div>
</div>
<section id="tampered-message">
<h4>Tampered Message<a class="headerlink" href="#tampered-message" title="Permalink to this headline">#</a></h4>
<p>Possible scenario:</p>
<ol class="simple">
<li><p>An attacker intercepts the message</p></li>
<li><p>They change the message and leave the signature intact</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wrong_message = b&quot;My website is http://www.google.com&quot;

verification_message = verify(signature, wrong_message, public_key)
print(verification_message)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The signature, the message or the Public Key is invalid
</pre></div>
</div>
</div>
</div>
</section>
<section id="tampered-message-and-signature">
<h4>Tampered Message and Signature<a class="headerlink" href="#tampered-message-and-signature" title="Permalink to this headline">#</a></h4>
<p>Possible scenario:</p>
<ol class="simple">
<li><p>An attacker intercepts the message</p></li>
<li><p>They change the message and generate another signature with their own Private Key</p></li>
</ol>
<p>Note: it would be possible to test leaving the message intact and only changing the signature but that has no practical purpose.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wrong_message = b&quot;My website is http://www.google.com&quot;

fake_private_key, _ = generate_key_pair()
fake_signature = sign(wrong_message, fake_private_key)

verification_message = verify(fake_signature, message, public_key)
print(verification_message)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The signature, the message or the Public Key is invalid
</pre></div>
</div>
</div>
</div>
</section>
<section id="unliked-public-key">
<h4>Unliked Public Key<a class="headerlink" href="#unliked-public-key" title="Permalink to this headline">#</a></h4>
<p>This is an unlikely possibility. Because since Public Keys are shared and public, an attacker has very limited chance to inject a fake public key. It would need to hack the sender and modify their Public Key, if they were able to do such a thing, they would have access the original message anyway.</p>
<p>However, for illustration, if the Public Key is changed, the validation fails as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>_, public_key_other = generate_key_pair()

verification_message = verify(signature, message, public_key_other)
print(verification_message)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The signature, the message or the Public Key is invalid
</pre></div>
</div>
</div>
</div>
</section>
<section id="original-message-signature-and-public-key">
<h4>Original Message, Signature and Public Key<a class="headerlink" href="#original-message-signature-and-public-key" title="Permalink to this headline">#</a></h4>
<p>Only when the message, the signature and the public match will the verficiation process succeed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>verification_message = verify(signature, message, public_key)
print(verification_message)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The message has been successfully verified
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="using-pem-files">
<h2>Using PEM Files<a class="headerlink" href="#using-pem-files" title="Permalink to this headline">#</a></h2>
<p>Public Keys, Private Keys and certificates can be saved as files, in that case the <a class="reference external" href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail">Privacy-Enhanced Mail (PEM)</a> format is used. Those are files with suffix <code class="docutils literal notranslate"><span class="pre">.pem</span></code>, <code class="docutils literal notranslate"><span class="pre">.cer</span></code>, <code class="docutils literal notranslate"><span class="pre">.cert</span></code> or <code class="docutils literal notranslate"><span class="pre">.crt</span></code>. They have a characteristic <code class="docutils literal notranslate"><span class="pre">BEGIN</span></code> and <code class="docutils literal notranslate"><span class="pre">END</span></code> line which encloses the content. Since a key pair is a sequence of bytes, base64 is used to convert those to string.</p>
<p>The extension is just to tell the content but the PEM format is a plain-text file, i.e. it can be opened with any text editor.</p>
<p>PEM Files can be used for either Public Key Encryption or Digital Signature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from pathlib import Path

from cryptography.hazmat.primitives import serialization
</pre></div>
</div>
</div>
</div>
<section id="storing-the-keys-as-pem-files">
<h3>Storing the Keys as PEM Files<a class="headerlink" href="#storing-the-keys-as-pem-files" title="Permalink to this headline">#</a></h3>
<section id="saving-private-key">
<h4>Saving Private Key<a class="headerlink" href="#saving-private-key" title="Permalink to this headline">#</a></h4>
<p>The PEM file for the private key <strong>should be kept secret</strong> and never shared, the <strong>whole asymmetric encryption depends on it being hidden</strong>.</p>
<p>Because the <a class="reference external" href="https://en.wikipedia.org/wiki/PKCS_8">Public-Key Cryptography Standards (PKCS) #8 (<code class="docutils literal notranslate"><span class="pre">PKCS8</span></code>)</a> is used as the serialization format, the private key is not stored in raw bytes but rather it is encrypted using symmetric encryption. The symmetric algorithm used is <a class="reference external" href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a>. Therefore, in theory there should not be any risks if the files is leaked, that being said, sharing private key files is against all good practices.</p>
<p><strong>Note: NEVER upload private key files to source control, make sure to add the file to your <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code></strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>password = b&quot;my secret&quot;

key_pem_bytes = private_key.private_bytes(
   encoding=serialization.Encoding.PEM,  # PEM Format is specified
   format=serialization.PrivateFormat.PKCS8,
   encryption_algorithm=serialization.BestAvailableEncryption(password),
)

# Filename could be anything
key_pem_path = Path(&quot;key.pem&quot;)
key_pem_path.write_bytes(key_pem_bytes);

warning_message = &quot;\n\n     TRUNCATED CONTENT TO REMIND THIS SHOULD NOT BE SHARED\n&quot;

content = key_pem_path.read_text()
content = content[:232] + warning_message + content[1597:]

print(content)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-----BEGIN ENCRYPTED PRIVATE KEY-----
MIIFLTBXBgkqhkiG9w0BBQ0wSjApBgkqhkiG9w0BBQwwHAQITdcvjNfCg54CAggA
MAwGCCqGSIb3DQIJBQAwHQYJYIZIAWUDBAEqBBB63C2EvdC8S4KeFMfIfQ8dBIIE
0BJIFtb1C+jS8fMwZJyfVQPJnEVB6G78A6iND3pYFlnLQZrzfBySFEOhTkINqjyD

     TRUNCATED CONTENT TO REMIND THIS SHOULD NOT BE SHARED

mtMXBV5t50HCwCCVqZK6a4VU+oCgIr0WdPXjSDvX+dToQRMECgpb0XKU5fMd1IQ4
+w45rFE7gv8VLNWEXtHVP6ZK2iD0XkjCQ8bPpMkUBPgslqsRt6/sHNaqt9cQHFjF
+fwe3xV2Ispfg1aMeTVlsmDqLoLfToSb+rU5+c/6/yIfYJekcZbhG6RFaiIs+GGo
6ZCp9bflBVXSjoCOeelKVW+oxtGzmJfSGZS/kP/dM457
-----END ENCRYPTED PRIVATE KEY-----
</pre></div>
</div>
</div>
</div>
</section>
<section id="saving-public-key">
<h4>Saving Public Key<a class="headerlink" href="#saving-public-key" title="Permalink to this headline">#</a></h4>
<p>The PEM file for the public key will be part of a public certificate which will be send to everyone wanting to comunicate with the subject. <strong>There is no risk sharing this</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>public_key = private_key.public_key()

public_pem_bytes = public_key.public_bytes(
   encoding=serialization.Encoding.PEM,
   format=serialization.PublicFormat.SubjectPublicKeyInfo,
)

# Filename could be anything
public_pem_path = Path(&quot;public.pem&quot;)
public_pem_path.write_bytes(public_pem_bytes);

public_key_content = public_pem_path.read_text()
print(public_key_content)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxFJRs3026S8P6OvPfPzS
n0CU6FzwZKCTUmqbM+wdH35uwrW2KNjiTUoKUkomFgfCeW1/WKr/vYsvZxwMhl+S
oshUVljsEUQ5WINIJKNwb1A3n07wefsee2Gztuu65OBVQAzJZUnXepZea/vwPA2S
JoiNIymUhxE6fR2EgMfHcKhZ9s6etREi9UqiowyBK6o2nJ0Ln8iR2L1+KPvQkZHd
6lQmMKGRuR3rwkBE+2bH/qCtc1aQ3XNhekKoo05p1IA8D0LyTZXBK/yX5+7PV1Ab
dmaEMWvL6TQHE6VX9ekIZ9+MibqaRRV/xry770JO4r9hwekYHvQlonPMAC68LyCj
VQIDAQAB
-----END PUBLIC KEY-----
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="loading-pem-files">
<h3>Loading PEM Files<a class="headerlink" href="#loading-pem-files" title="Permalink to this headline">#</a></h3>
<p>PEM files can be loaded directly using the load methods, in the case of the private key, a password should be provided because the <code class="docutils literal notranslate"><span class="pre">PKCS8</span></code> was used to serialized it.</p>
<section id="wrong-password">
<h4>Wrong Password<a class="headerlink" href="#wrong-password" title="Permalink to this headline">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">cryptography</span></code> library will throw <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if the password is incorrect</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>private_pem_bytes = Path(&quot;key.pem&quot;).read_bytes()
public_pem_bytes = Path(&quot;public.pem&quot;).read_bytes()

guess_password = b&quot;my pass&quot;

try:
    private_key_from_pem = serialization.load_pem_private_key(
        private_pem_bytes,
        password=guess_password,
    )
    public_key_from_pem = serialization.load_pem_public_key(public_pem_bytes)
    print(&quot;Keys Correctly Loaded&quot;)
except ValueError:
    print(&quot;Incorrect Password&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Incorrect Password
</pre></div>
</div>
</div>
</div>
</section>
<section id="right-password">
<h4>Right Password<a class="headerlink" href="#right-password" title="Permalink to this headline">#</a></h4>
<p>If the correct password is used, no errors should be thrown</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>private_pem_bytes = Path(&quot;key.pem&quot;).read_bytes()
public_pem_bytes = Path(&quot;public.pem&quot;).read_bytes()

try:
    private_key_from_pem = serialization.load_pem_private_key(
        private_pem_bytes,
        password=password,
    )
    public_key_from_pem = serialization.load_pem_public_key(public_pem_bytes)
    print(&quot;Keys Correctly Loaded&quot;)
except ValueError:
    print(&quot;Incorrect Password&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Keys Correctly Loaded
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="encryption-and-decryption-using-pem-files">
<h3>Encryption and Decryption using PEM Files<a class="headerlink" href="#encryption-and-decryption-using-pem-files" title="Permalink to this headline">#</a></h3>
<p>This are simple examples of encryption and decryption, the functions used are the same as the ones in the above section</p>
<section id="id2">
<h4>Encrypting<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>message = b&quot;Hello World!&quot;

public_pem_bytes = Path(&quot;public.pem&quot;).read_bytes()
public_key_from_pem = serialization.load_pem_public_key(public_pem_bytes)

message_encrypted = encrypt(message, public_key_from_pem)

print(f&quot;Encrypted Text: {message_encrypted.hex()}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Encrypted Text: b58f3e7cc8c40d5dec6f2509e602d785fbd90a97f2605c1cc443068641c2cc3f06178a90995a2b20d7c8a6e1a9f78021b497cac57fb1f0c02d518783a5c77d573137dbd9875b8cae59c3fc94c6553c79bf18712ee9d7885f73124942fd1a097421d5b2ec1c46033e988e4d4db710bef2bac26a5aec1a9003ec167ee6c08bf5e30e41930d823cb985b5b67873e33cadc50d4cd3aad0b937f46528d0f000d822e1b1e683ff00485f6ae97b082df6824d05b5203097a6f4e3c74838436f39be035752ccc22de9a432467db062c9bdb5983fe2a930e143907643fb153266029d7f9f58dbb026ede1ba51e61838359bb80737e6b73f206e74afc2811d141ca3972009
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h4>Decrypting<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>private_pem_bytes = Path(&quot;key.pem&quot;).read_bytes()

private_key_from_pem = serialization.load_pem_private_key(
    private_pem_bytes,
    password=password,
)

message_decrypted = decrypt(message_encrypted, private_key_from_pem)

print(message_decrypted)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Decrypted Message: b&#39;Hello World!&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="digital-signature-using-pem-files">
<h3>Digital Signature using PEM Files<a class="headerlink" href="#digital-signature-using-pem-files" title="Permalink to this headline">#</a></h3>
<p>This are simple examples of signing and verification, the functions used are the same as the ones in the above section</p>
<section id="signing-a-message">
<h4>Signing a Message<a class="headerlink" href="#signing-a-message" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>message = b&quot;My website is http://elc.github.io&quot;

private_pem_bytes = Path(&quot;key.pem&quot;).read_bytes()

private_key_from_pem = serialization.load_pem_private_key(
    private_pem_bytes,
    password=password,
)

signature = sign(message, private_key_from_pem)

print(f&quot;Digital Signature: {signature.hex()}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Digital Signature: 2dfa1ee20a201f382eb69b5b0b4b7901330de4eaf6cabdc4926700bb114e39934b1c4feb770ced781a86113f1693130caecee53cc9e422a8fd9830d69c3ae8de9cb3140c1cb00ba28fa87a284382ef6000d1929c072435bc25ce442a6bdf6bcbd87c0b2877b6adda9509987319267265c5a0e7570b5176f6843f3cf15d671c0b2ca145647aa029d329830a8e7cf6be8e2eb9b1de9a141f3547ab513973be194effdf46826f6a30cd14782b1f0925fb453e5abc9647f29a7e9896542c316a740b6f4e636c2d99ccaa01da9291430653c6be8023a0fb4d30cbd047483885584dea246e0e0130d490c8f6d27cb0baa839ba672a320734f262fde6aceae1a4aff127
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h4>Verifying Signature<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>public_pem_bytes = Path(&quot;public.pem&quot;).read_bytes()
public_key_from_pem = serialization.load_pem_public_key(public_pem_bytes)

verification_message = verify(signature, message, public_key_from_pem)
print(verification_message)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The message has been successfully verified
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">#</a></h2>
<p>As opposed to symmetric encryption, asymmetric encryption does not rely on a single key shared across parties. Instead, a Key Pair, consisting of a Public and a Private Key which are mathematically linked, is generated by each party, then the public keys are shared. The public key is used to encrypt the message and only the linked Private Key can decrypt it.</p>
<p>Digital Signatures used the same principle in reverse, the Private Key is used to encrypt and the Public Key to decrypt, this does not provide privacy but guarantees that a message has not been tampered with.</p>
<p>For serialization and persistance Key Pairs can be stored in disk using the PEM format, for security reasons the Private Key PEM file is saved encrypted with symmetric encryption and hence requires a passphrase.</p>
<p>Asymmetric Encryption is mostly used as part of a bigger technology called Certificates which provides not only access to the Public Key needed to encrypt the message but also information about the subject, the issuer and a digital signature (among other fields). Certificates could be self-signed (insecure or only suitable for testing) or signed by a trusted third party called Certificate Authority.</p>
<p>The most widely used algorithm for Public Key Encryption and Digital Signatures is RSA and for Certificate Based Comunication is X.509</p>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Digital signature is the topic of the next chapter</p>
</dd>
</dl>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "ELC/python-security",
            ref: "source",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="06_Symmetric_Encryption.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Symmetric Encryption</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="08_Input_Sanitization.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Input Sanitization - Under Construction</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Ezequiel Leonardo Castaño<br/>
  
      &copy; Copyright 2021, Ezequiel Leonardo Castaño.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>