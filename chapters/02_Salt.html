
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Salt &#8212; Python Security</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/justify.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/analytics_gtag.js"></script>
    <script src="../_static/analytics.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://elc.github.com/python-security/chapters/02_Salt.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pepper" href="03_Pepper.html" />
    <link rel="prev" title="Hash Functions" href="01_Hash_Introduction.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Python Security</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="00_Fundamentals.html">
                    Introduction to Security
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Hashes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_Hash_Introduction.html">
   Hash Functions
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Salt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_Pepper.html">
   Pepper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_Checksum.html">
   Checksum
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_HMAC.html">
   HMAC
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Encryption
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="06_Symmetric_Encryption.html">
   Symmetric Encryption
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_Asymmetric_Encryption.html">
   Asymmetric Encryption
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Threats
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="08_Input_Sanitization.html">
   Input Sanitization - Under Construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_Common_Threats.html">
   Common Threats - Under Construction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Applications
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="10_JSON_Web_Tokens.html">
   JSON Web Tokens (JWT)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="19_Blockchain.html">
   BlockChain - Under Construction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Additional Material
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="80_Additional_Resources.html">
   Additional Resources
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="91_Bytes.html">
   Bytes Data Type
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="92_Base64.html">
   Base64 Encoding
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/ELC/python-security/source?urlpath=tree/chapters/02_Salt.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/ELC/python-security/blob/source/chapters/02_Salt.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ELC/python-security"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ELC/python-security/edit/source/chapters/02_Salt.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/chapters/02_Salt.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scrypt">
   Scrypt
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scrypt-disadvantages">
   Scrypt Disadvantages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scrypt-bonuses">
   Scrypt Bonuses
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#customizing-length">
     Customizing Length
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#customizing-execution-time">
     Customizing Execution Time
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#code-examples">
       Code Examples
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-user-authentication">
   Example: User Authentication
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#auxiliary-functions">
     Auxiliary Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sign-up">
     Sign Up
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wrong-email">
     Wrong Email
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wrong-password">
     Wrong Password
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#successful-login">
     Successful Login
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Salt</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scrypt">
   Scrypt
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scrypt-disadvantages">
   Scrypt Disadvantages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scrypt-bonuses">
   Scrypt Bonuses
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#customizing-length">
     Customizing Length
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#customizing-execution-time">
     Customizing Execution Time
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#code-examples">
       Code Examples
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-user-authentication">
   Example: User Authentication
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#auxiliary-functions">
     Auxiliary Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sign-up">
     Sign Up
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wrong-email">
     Wrong Email
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wrong-password">
     Wrong Password
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#successful-login">
     Successful Login
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="salt">
<h1>Salt<a class="headerlink" href="#salt" title="Permalink to this headline">#</a></h1>
<p><strong>ToDo</strong>:</p>
<ul class="simple">
<li><p>Add illustration for the salting process - Similar to <a class="reference external" href="https://www.php.net/manual/es/images/2a34c7f2e658f6ae74f3869f2aa5886f-crypt-text-rendered.svg">this</a> and <a class="reference external" href="https://forum.huawei.com/enterprise/en/data/attachment/forum/201901/21/003213sdbhypkqzdbdplfp.png?cf490-password_hashing.png">this</a>.</p></li>
<li><p>Explain the concept of Key Derivation Function - Similar to <a class="reference external" href="https://en.bitcoinwiki.org/upload/en/images/0/0e/Keyderivationfuncion.gif">this</a> and <a class="reference external" href="https://i.stack.imgur.com/z37E4.png">this</a>.</p></li>
<li><p>Add resources to other salt compatible algorithms - Argon2 for instance.</p></li>
<li><p>Add appendix regarding read/write hashes to database.</p></li>
<li><p>Add relevant resources at the end</p></li>
</ul>
<hr class="docutils" />
<p>In the case of data that tend to be similar for different users (e.g. common used passwords), if the database with all hashes is compromised, an attacker could see if any of the hashes corresponds with a hash from a pre-computed table, examples of this are <a class="reference external" href="https://en.wikipedia.org/wiki/Rainbow_table">Rainbow Attacks</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Dictionary_attack">Dictionary Attacks</a>.</p>
<p>If a random array of bytes is added to the data to be hashed, then the results will not match any pre-computed table attackers might have. This also implies the array of random bytes should be provided along with the hash in order to validate the hash is correct. These bytes are called <strong>salt</strong> and they are not secret (i.e. they can be store in plain text). Even though one might think that salts should be kept secret, there are other vulnerabilities associated with <em>secret salts</em>, such as <a class="reference external" href="https://www.wikiwand.com/en/Length_extension_attack">Length Extension Attacks</a></p>
<section id="scrypt">
<h2>Scrypt<a class="headerlink" href="#scrypt" title="Permalink to this headline">#</a></h2>
<p>The hashlib module has the function <a class="reference external" href="https://docs.python.org/3/library/hashlib.html#hashlib.scrypt"><code class="docutils literal notranslate"><span class="pre">scrypt</span></code></a>, which provides a convinient interface to add salts to hashes. This function is an implementation of the <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc7914.html">RFC 7914</a>, it was designed to be memory-intensive and prevent GPU, ASIC and FPGA attacks.</p>
<p><strong>Note:</strong> Salt could be of any lenght, however a minimum of 128bits (10 bytes) is recommended.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import secrets
import hashlib
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>random_bytes = secrets.token_bytes(10)
data = b&quot;Hello World!&quot;
data_hashed = hashlib.scrypt(data, salt=random_bytes, n=64, r=8, p=1).hex()
salt_string = random_bytes.hex()

print(f&quot;   Original: {data}&quot;)
print(f&quot;     Hashed: {data_hashed}&quot;)
print(f&quot;Salt+Hashed: {salt_string}:{data_hashed}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   Original: b&#39;Hello World!&#39;
     Hashed: 83e550df8eea0b3e73bcafcff2d8bddded69a3470a334ab8aff36896c0956dfa9c397ba5e38d895de7ed8877d03cac56fc0d3efae79de96d0c493ac18561ec0e
Salt+Hashed: 0c879eb784b548b3d795:83e550df8eea0b3e73bcafcff2d8bddded69a3470a334ab8aff36896c0956dfa9c397ba5e38d895de7ed8877d03cac56fc0d3efae79de96d0c493ac18561ec0e
</pre></div>
</div>
</div>
</div>
</section>
<section id="scrypt-disadvantages">
<h2>Scrypt Disadvantages<a class="headerlink" href="#scrypt-disadvantages" title="Permalink to this headline">#</a></h2>
<p>The hashed string depends on several parameters, <strong>n</strong>, <strong>r</strong>, <strong>p</strong> and the <strong>salt</strong>. Unless they are hardcoded in the source code it is a good practice to store them along with the hash.</p>
<p>The delimiter character is usually either “<strong>$</strong>” or “<strong>:</strong>”. Other options include using several columns in the database. Note that neither of the two are URL Safe, this is sensible because hashes should never be part of a URL</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>random_bytes = secrets.token_bytes(10)
data = b&quot;Hello World!&quot;

n = 2 ** 6
r = 8
p = 1
data_hashed = hashlib.scrypt(data, salt=random_bytes, n=n, r=r, p=p).hex()
salt_string = random_bytes.hex()

print(f&quot;n+r+pSalt+Hashed: {n}${r}${p}${salt_string}${data_hashed}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>n+r+pSalt+Hashed: 64$8$1$919ab62c1751e5175200$e1f80b783dcb4187331d04e66019fbb872a174e5e0e1ebb723aaccc2e92f36dd4eaf89fedfcd2a269fab4db03dcf894a4f9c56723db62ec8ace84792cc52e8d9
</pre></div>
</div>
</div>
</div>
</section>
<section id="scrypt-bonuses">
<h2>Scrypt Bonuses<a class="headerlink" href="#scrypt-bonuses" title="Permalink to this headline">#</a></h2>
<p>Using the scrypt function also provides some additional advantages</p>
<section id="customizing-length">
<h3>Customizing Length<a class="headerlink" href="#customizing-length" title="Permalink to this headline">#</a></h3>
<p>There is an additional parameter, <strong><code class="docutils literal notranslate"><span class="pre">dklen</span></code></strong>, which allows to generate arbitrary long passwords, the default value is 64.</p>
<p><strong>Important Note:</strong> Using short lenghts will increase collision risks</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>data = b&quot;Hello World!&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>lenght = 2**2
random_bytes = secrets.token_bytes(10)

data_hashed = hashlib.scrypt(data, salt=random_bytes, n=64, r=8, p=1, dklen=lenght).hex()
salt_string = random_bytes.hex()

print(f&quot;Salt+Hashed: {salt_string}:{data_hashed}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Salt+Hashed: 5c1945730bde7053e3de:b8e77137
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>lenght = 2**4
random_bytes = secrets.token_bytes(10)

data_hashed = hashlib.scrypt(data, salt=random_bytes, n=64, r=8, p=1, dklen=lenght).hex()
salt_string = random_bytes.hex()

print(f&quot;Salt+Hashed: {salt_string}:{data_hashed}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Salt+Hashed: 921db1fd105ca87427cd:e72e8866ab09b19465ba2ea319c38eec
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>lenght = 2**6
random_bytes = secrets.token_bytes(10)

data_hashed = hashlib.scrypt(data, salt=random_bytes, n=64, r=8, p=1, dklen=lenght).hex()
salt_string = random_bytes.hex()

print(f&quot;Salt+Hashed: {salt_string}:{data_hashed}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Salt+Hashed: 338355fa04e4e7aaa54a:cf219b6b2bd6168d10c70ad2eeaeeddedd1574fe299e959673dfc387a0771adff9a39f8c99d2a2156e431478100e6382d173337d0c41cde0a84ca0bf9bf75c56
</pre></div>
</div>
</div>
</div>
</section>
<section id="customizing-execution-time">
<h3>Customizing Execution Time<a class="headerlink" href="#customizing-execution-time" title="Permalink to this headline">#</a></h3>
<p>In some application making the hash slower can increase the security, the scrypt algorithm can be customized to take different amounts of memory and processing time.</p>
<p>The memory used will be equal to: 128 * n * r * p bytes</p>
<p>Examples:</p>
<ul class="simple">
<li><p>Low Memory Footprint: 128 * 64 * 8 * 1 = 64 KB</p></li>
<li><p>Large Memory Footprint: 128 * 2^17 * 8 * 1 = 128 MB</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>n = 2 ** 20
r = 8
p = 1
memory_bytes = 128 * n * r * p
memory_kilo_bytes = memory_bytes / 1024
memory_mega_bytes = memory_kilo_bytes / 1024
print(f&quot;Memory Consumed: {memory_bytes} bytes = {memory_kilo_bytes:.2f} KB = {memory_mega_bytes:.2f} MB&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Memory Consumed: 1073741824 bytes = 1048576.00 KB = 1024.00 MB
</pre></div>
</div>
</div>
</div>
<section id="code-examples">
<h4>Code Examples<a class="headerlink" href="#code-examples" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>data = b&quot;Hello World!&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%timeit
n = 2**6  # 64
random_bytes = secrets.token_bytes(16)
data_hashed = hashlib.scrypt(data, salt=random_bytes, n=n, r=8, p=1).hex()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>252 µs ± 136 ns per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%timeit
n = 2**12
random_bytes = secrets.token_bytes(16)
data_hashed = hashlib.scrypt(data, salt=random_bytes, n=n, r=8, p=1).hex()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13.7 ms ± 42.1 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%timeit
n = 2**14
random_bytes = secrets.token_bytes(16)
data_hashed = hashlib.scrypt(data, salt=random_bytes, n=n, r=8, p=1).hex()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>55.4 ms ± 189 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="example-user-authentication">
<h2>Example: User Authentication<a class="headerlink" href="#example-user-authentication" title="Permalink to this headline">#</a></h2>
<p>The following example showcases how scrypt can be used to securely store passwords.</p>
<p><strong>Note: Remember that this code is not suitable for any production use-case.</strong></p>
<section id="auxiliary-functions">
<h3>Auxiliary Functions<a class="headerlink" href="#auxiliary-functions" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def generate_hash(data:str, salt: bytes) -&gt; str:
    data_bytes = data.encode(&quot;utf-8&quot;)
    data_hashed = hashlib.scrypt(data_bytes, salt=salt, n=64, r=8, p=1)
    return f&quot;{salt.hex()}:{data_hashed.hex()}&quot;


def sign_up(email, password, database_):
    database = database_.copy()
    random_bytes = secrets.token_bytes(10)
    database[email] = generate_hash(password, random_bytes)
    print(&quot;Successfully Singed Up&quot;)
    return database


def login(email, password, database):
    if email not in database:
        print(f&quot;ERROR: User {email} not in Database&quot;)
        return

    expected_password = database[email]
    salt, hashed = expected_password.split(&quot;:&quot;)
    salt_bytes = bytes.fromhex(salt)
    calculated_hash = generate_hash(password, salt_bytes)
    passwords_matched = secrets.compare_digest(expected_password, calculated_hash) 
    if passwords_matched:
        print(f&quot;Successfully Signed in: {email}&quot;)
        return
    
    print(f&quot;ERROR: Incorrect Password for: {email}&quot;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="sign-up">
<h3>Sign Up<a class="headerlink" href="#sign-up" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>email = &quot;johndoe@example.com&quot;
password = &quot;password123&quot;
user_database = {}

user_database = sign_up(email, password, user_database)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Successfully Singed Up
</pre></div>
</div>
</div>
</div>
</section>
<section id="wrong-email">
<h3>Wrong Email<a class="headerlink" href="#wrong-email" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>email = &quot;janedoe@example.com&quot;
password = &quot;password123&quot;

login(email, password, user_database)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR: User janedoe@example.com not in Database
</pre></div>
</div>
</div>
</div>
</section>
<section id="wrong-password">
<h3>Wrong Password<a class="headerlink" href="#wrong-password" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>email = &quot;johndoe@example.com&quot;
password = &quot;password&quot;

login(email, password, user_database)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR: Incorrect Password for: johndoe@example.com
</pre></div>
</div>
</div>
</div>
</section>
<section id="successful-login">
<h3>Successful Login<a class="headerlink" href="#successful-login" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>email = &quot;johndoe@example.com&quot;
password = &quot;password123&quot;

login(email, password, user_database)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Successfully Signed in: johndoe@example.com
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">#</a></h2>
<p>Hash algorithms themselves have a drawback, anyone can pre-compute most commonly use values and simply do a one by one comparison searching for matches. However, thanks to the small changes in input big changes in output feature of cryptographic hashes, simply adding some bytes to the data mitigates this risk by a great ammount. This bytes are called <strong>salt</strong>, they are public and stored along with the hash. One of the algorithms that uses it is <a class="reference external" href="https://docs.python.org/3/library/hashlib.html#hashlib.scrypt"><code class="docutils literal notranslate"><span class="pre">scrypt</span></code></a>, which is available in the standard library. This particular algorithm also allows customization of memory consumption/processing time.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "ELC/python-security",
            ref: "source",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="01_Hash_Introduction.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Hash Functions</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03_Pepper.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Pepper</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Ezequiel Leonardo Castaño<br/>
  
      &copy; Copyright 2021, Ezequiel Leonardo Castaño.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>