
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Symmetric Encryption &#8212; Python Security</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/justify.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/analytics_gtag.js"></script>
    <script src="../_static/analytics.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://elc.github.com/python-security/chapters/06_Symmetric_Encryption.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Asymmetric Encryption" href="07_Asymmetric_Encryption.html" />
    <link rel="prev" title="HMAC" href="05_HMAC.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Python Security</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="00_Fundamentals.html">
                    Introduction to Security
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Hashes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_Hash_Introduction.html">
   Hash Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_Salt.html">
   Salt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_Pepper.html">
   Pepper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_Checksum.html">
   Checksum
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_HMAC.html">
   HMAC
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Encryption
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Symmetric Encryption
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_Asymmetric_Encryption.html">
   Asymmetric Encryption
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Threats
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="08_Input_Sanitization.html">
   Input Sanitization - Under Construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_Common_Threats.html">
   Common Threats - Under Construction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Applications
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="10_JSON_Web_Tokens.html">
   JSON Web Tokens (JWT)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="19_Blockchain.html">
   BlockChain - Under Construction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Additional Material
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="80_Additional_Resources.html">
   Additional Resources
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="91_Bytes.html">
   Bytes Data Type
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="92_Base64.html">
   Base64 Encoding
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/ELC/python-security/source?urlpath=tree/chapters/06_Symmetric_Encryption.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/ELC/python-security/blob/source/chapters/06_Symmetric_Encryption.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ELC/python-security"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ELC/python-security/edit/source/chapters/06_Symmetric_Encryption.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/chapters/06_Symmetric_Encryption.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#encryption-encoding">
   Encryption != Encoding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#authenticated-vs-non-authenticated-symmetric-encryption">
   Authenticated vs Non-Authenticated Symmetric Encryption
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-cryptography-library">
   The Cryptography Library
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#symmetric-encryption-without-authentication">
   Symmetric Encryption without Authentication
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#encrypting">
     Encrypting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decrypting">
     Decrypting
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wrong-key">
       Wrong Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#right-key">
       Right Key
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#symmetric-encryption-with-authentication">
   Symmetric Encryption with Authentication
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Encrypting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Decrypting
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Wrong Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Right Key
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-fernet-method">
   The Fernet Method
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Encrypting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Decrypting
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id7">
       Wrong Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       Right Key
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conclusion">
     Conclusion
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Symmetric Encryption</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#encryption-encoding">
   Encryption != Encoding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#authenticated-vs-non-authenticated-symmetric-encryption">
   Authenticated vs Non-Authenticated Symmetric Encryption
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-cryptography-library">
   The Cryptography Library
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#symmetric-encryption-without-authentication">
   Symmetric Encryption without Authentication
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#encrypting">
     Encrypting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decrypting">
     Decrypting
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wrong-key">
       Wrong Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#right-key">
       Right Key
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#symmetric-encryption-with-authentication">
   Symmetric Encryption with Authentication
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Encrypting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Decrypting
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Wrong Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Right Key
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-fernet-method">
   The Fernet Method
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Encrypting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Decrypting
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id7">
       Wrong Key
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       Right Key
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conclusion">
     Conclusion
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="symmetric-encryption">
<h1>Symmetric Encryption<a class="headerlink" href="#symmetric-encryption" title="Permalink to this headline">#</a></h1>
<p><strong>ToDo</strong>:</p>
<ul class="simple">
<li><p>Add illustration for Symmetric Encryption - Similar to <a class="reference external" href="https://miro.medium.com/max/1400/1*mnyITCNnRdeLfauh3Psmlw.png">this</a>.</p></li>
<li><p>Add illustration for authenticated vs non-autenticated encryption.</p></li>
<li><p>Explain difference between EtM, E&amp;M and MtE - See <a class="reference external" href="https://en.wikipedia.org/wiki/Authenticated_encryption#Approaches_to_authenticated_encryption">this</a>.</p></li>
<li><p>Add relevant resources at the end.</p></li>
</ul>
<hr class="docutils" />
<p>Encryption is the process of transforming a message, usually called cyphered message, in such a way that only the intended parties can reverse it. The process of reversing encryption is called decryption. This implies that, as opposed to hashes, encryption is <strong>reversible</strong>.</p>
<p>There are two main types of encryption, symmetric and asymmetric, this chapter will cover symmetric encryption.</p>
<p>In symmetric encryption, the message to be sent is encrypted using a single <strong>secret</strong> password, also called key. Anyone with that secret key and decrypt the message and see the original content.</p>
<p>This type of encryption is fast, reliable and extremely secure, however it has a major disadvantages, the <strong>secret</strong> key must be shared between the intended parties and the whole encryption procedure will be as secure as the security used for that key exchange. That is why usually other mechanisms such as asymmetric encryption are used only for the key-exchange.</p>
<section id="encryption-encoding">
<h2>Encryption != Encoding<a class="headerlink" href="#encryption-encoding" title="Permalink to this headline">#</a></h2>
<p>Some times this terms are confused, <strong>encryption</strong> as mentioned is reversible but only by the intended parties whereas <strong>encoding</strong> is simply a way to transform a message in a <strong>non-secure</strong> way, mainly as means of compression or to transform a message into a more suitable format.</p>
<p>One of the most common encodings used is Base64, which can be used to send binary files (PDFs, images, etc.) as plain text in HTTP Requests. Working with Base64 is a topic outside of this guide, however some introductory material is provided in <a class="reference internal" href="92_Base64.html"><span class="doc std std-doc">one of the appendixes</span></a>.</p>
</section>
<section id="authenticated-vs-non-authenticated-symmetric-encryption">
<h2>Authenticated vs Non-Authenticated Symmetric Encryption<a class="headerlink" href="#authenticated-vs-non-authenticated-symmetric-encryption" title="Permalink to this headline">#</a></h2>
<p>A futher categorization of symmetric encryption algorithms is between those with authentication features and those without. Both provide a way to securely transmit a meesage, however, <a class="reference external" href="https://en.wikipedia.org/wiki/Authenticated_encryption">authenticated Encryption</a> also allows, among other things, to verify whether the ciphered message has been modified.</p>
<p>Modifying the ciphered message in a non-authenticated scheme will produce a nonsensical output whereas in authenticated encryption it will throw an error.</p>
</section>
<section id="the-cryptography-library">
<h2>The Cryptography Library<a class="headerlink" href="#the-cryptography-library" title="Permalink to this headline">#</a></h2>
<p>Python does not include any symmetric encryption features in its standard library, therefore, to use it one should install a third party tool. It is of great importance that the library to be used has some characteristics to ensure real security:</p>
<ul class="simple">
<li><p>It should be built only on the standard library, this will ensure full compatibility and avoid dependency-related problems.</p></li>
<li><p>It should be open source, that way the code could be review and everyone knows exactly how it works.</p></li>
<li><p>It should be time-proved, new libraries tend to have bugs or poor implementations, libraries with some time online are usually prefered.</p></li>
<li><p>It should be used by trustworthy users, if it is an industry standard it means many companies and individuals trust it.</p></li>
</ul>
<p>The Python Cryptographic Authority, or pyca for short, is a non-official group of users who developed cryptographic libraries for this very purpose. It supports symmetric (authenticated and non-authenticated) and asymmetric encryption.</p>
<p>The most common and used is homonomous to the group name: <code class="docutils literal notranslate"><span class="pre">cryptography</span></code></p>
<p>It can be install via <code class="docutils literal notranslate"><span class="pre">pip</span></code> with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">cryptography</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import secrets
import cryptography
</pre></div>
</div>
</div>
</div>
</section>
<section id="symmetric-encryption-without-authentication">
<h2>Symmetric Encryption without Authentication<a class="headerlink" href="#symmetric-encryption-without-authentication" title="Permalink to this headline">#</a></h2>
<p>One of the most popular algorithms used is the <a class="reference external" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">Advanced Encryption Standard (AES)</a>. It works in combination with a <a class="reference external" href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">Mode of Operation</a>, this modes change the way in which the cyphered message is generated.</p>
<p>Depending on the mode, the result could be authenticated or non-authenticated. The available (in the cryptography module) modes for non-authenticated encryption are <a class="reference external" href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher_block_chaining_(CBC)">CBC</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher_feedback_(CFB)">CFB</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Output_feedback_(OFB)">OFB</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Counter_(CTR)">CTR</a>. For more information see <a class="reference external" href="https://www.highgo.ca/2019/08/08/the-difference-in-five-modes-in-the-aes-encryption-algorithm/">this resource</a>.</p>
<p>Usually the name of the algorithm is called <strong>AES-MODE</strong> in this chapter for non-authenticated encryption <strong>AES-CTR</strong> will be used.</p>
<p>AES is one of the symmetric encryption algorithms available in the PyCA <code class="docutils literal notranslate"><span class="pre">cryptography</span></code> library. The particular objects used here are part of the <code class="docutils literal notranslate"><span class="pre">hazmat</span></code> package, <code class="docutils literal notranslate"><span class="pre">hazmat</span></code> stands for “Hazardous Materials” and quoting from their <a class="reference external" href="https://cryptography.io/en/latest/hazmat/primitives/asymmetric/rsa/">site</a>:</p>
<blockquote>
<div><p>This is a “Hazardous Materials” module. You should ONLY use it if you’re 100% absolutely sure that you know what you’re doing because this module is full of land mines, dragons, and dinosaurs with laser guns.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
</pre></div>
</div>
</div>
</div>
<section id="encrypting">
<h3>Encrypting<a class="headerlink" href="#encrypting" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>message = b&quot;Hello World!&quot;

key = secrets.token_bytes(32)
initialization_vector = secrets.token_bytes(16)

algorithm = algorithms.AES(key)
mode = modes.CTR(initialization_vector)

cipher = Cipher(algorithm, mode)
encryptor = cipher.encryptor()

message_encrypted = encryptor.update(message) + encryptor.finalize()

print(f&quot;Secret Key: {key.hex()}&quot;)
print(f&quot;Public Initialization Vector: {initialization_vector.hex()}&quot;)
print(f&quot;Encrypted Message: {message_encrypted.hex()}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Secret Key: d84d41cdf66296169b5fd2c7ce76df60882526e42adb097c5c2acc03279f74aa
Public Initialization Vector: f915c337f2f9155213fcf0dca1ae964a
Encrypted Message: 7568ffcde99e9e39be8a2244
</pre></div>
</div>
</div>
</div>
</section>
<section id="decrypting">
<h3>Decrypting<a class="headerlink" href="#decrypting" title="Permalink to this headline">#</a></h3>
<section id="wrong-key">
<h4>Wrong Key<a class="headerlink" href="#wrong-key" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>guess_password = secrets.token_bytes(32)

algorithm = algorithms.AES(guess_password)
mode = modes.CTR(initialization_vector)

cipher = Cipher(algorithm, mode)

decryptor = cipher.decryptor()
message_decrypted = decryptor.update(message_encrypted) + decryptor.finalize()

print(f&quot;Decrypted Message: {message_decrypted}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Decrypted Message: b&#39;dJ\xdd\xbc\x03@\xa1\x01\xf62\xd3\x94&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="right-key">
<h4>Right Key<a class="headerlink" href="#right-key" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>algorithm = algorithms.AES(key)
mode = modes.CTR(initialization_vector)

cipher = Cipher(algorithm, mode)

decryptor = cipher.decryptor()
message_decrypted = decryptor.update(message_encrypted) + decryptor.finalize()
print(f&quot;Decrypted Message: {message_decrypted}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Decrypted Message: b&#39;Hello World!&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="symmetric-encryption-with-authentication">
<h2>Symmetric Encryption with Authentication<a class="headerlink" href="#symmetric-encryption-with-authentication" title="Permalink to this headline">#</a></h2>
<p>The same AES algorithm can be combined with modes that results in a authenticated encryption. Such modes are <a class="reference external" href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">GCM</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/OCB_mode">OCB3</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/CCM_mode">CCM</a>.</p>
<p>Even though they provide more features that the non-authenticated modes, they are sensitive to nonce re-use, having known vulnerabilities if the same nonce is used twice. There is a new generation of modes called <strong>Synthetic Initialization Vector (SIV)</strong> which mitigates this risks, producing modes like <a class="reference external" href="https://en.wikipedia.org/wiki/AES-GCM-SIV">AES-GCM-SIV</a> and so on, this new generation has no time-proved implementation neither in Python nor in other programming language at the time of this writting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from cryptography.hazmat.primitives.ciphers.aead import AESGCM
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>Encrypting<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>message = b&quot;Hello World!&quot;

key = secrets.token_bytes(32) # 16, 24, or 32
nonce = secrets.token_bytes(24)

ciphered_message = AESGCM(key).encrypt(nonce, message, None)

encrypted_message = f&quot;{nonce.hex()}:{ciphered_message.hex()}&quot;

print(f&quot;Secret Key: {key.hex()}&quot;)
print(f&quot;Public Nonce: {nonce.hex()}&quot;)
print(f&quot;Encrypted Message: {encrypted_message}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Secret Key: 6550164006d556e10308967538f097b425b662b07414a464cfef03fb7c7e0327
Public Nonce: 5efdeef65e862baf5de8bf8ace72599e4e06624bc3c3e983
Encrypted Message: 5efdeef65e862baf5de8bf8ace72599e4e06624bc3c3e983:464332a2c34fca88fdc5ce4424aa55a38f5e9ed1668243806eb132ec
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h3>Decrypting<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def verify(password, nonce, message):
    try:
        decrypted_message = AESGCM(password).decrypt(nonce, message, None)
        return f&quot;Decrypted Message: {message_decrypted}&quot;
    except cryptography.exceptions.InvalidTag:
        return &quot;Verification Failed - Either the message has been altered or the nonce or key are incorrect&quot;
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h4>Wrong Key<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>guess_password = bytes.fromhex(&quot;1329f363a87306c33952a7cbfc0ebf8105126764d1c72c511031a5b028110cf9&quot;)

nonce, ciphered_message = encrypted_message.split(&quot;:&quot;)
nonce_bytes = bytes.fromhex(nonce)
ciphered_message_bytes = bytes.fromhex(ciphered_message)

print(verify(guess_password, nonce_bytes, ciphered_message_bytes))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Verification Failed - Either the message has been altered or the nonce or key are incorrect
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h4>Right Key<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>nonce, ciphered_message = encrypted_message.split(&quot;:&quot;)
nonce_bytes = bytes.fromhex(nonce)
ciphered_message_bytes = bytes.fromhex(ciphered_message)

print(verify(key, nonce_bytes, ciphered_message_bytes))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Decrypted Message: b&#39;Hello World!&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="the-fernet-method">
<h2>The Fernet Method<a class="headerlink" href="#the-fernet-method" title="Permalink to this headline">#</a></h2>
<p>The <a class="reference external" href="https://github.com/fernet/spec/blob/master/Spec.md">Fernet</a> method is an opinionated way of using AES and HMAC to provide authenticated encryption. It is meant for easy use but it requires that the recipient also has a library compatible with it to effectively use it.</p>
<p>It is not nearly as commonly used as the other methods described in this chapter but it is much more practical for simple use cases.</p>
<p>At the time of this writing there are implementations for:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/fernet/fernet-go">Go (official)</a></p></li>
<li><p><a class="reference external" href="https://github.com/fernet/fernet-rb">Ruby (official)</a></p></li>
<li><p><a class="reference external" href="https://github.com/fernet/fernet-erl">Erlang (official)</a></p></li>
<li><p><a class="reference external" href="https://cryptography.io/en/latest/fernet/">Python</a> (i.e. using cryptography)</p></li>
<li><p><a class="reference external" href="https://www.npmjs.com/package/fernet">Javascript (Node)</a>.</p></li>
</ul>
<p>This method also allows the usage of <strong>passwords (human-readable)</strong> instead of random bytes as keys, see <a class="reference external" href="https://cryptography.io/en/latest/fernet/#using-passwords-with-fernet">this example</a> for more information.</p>
<p>The Fernet algorithm is not part of the <code class="docutils literal notranslate"><span class="pre">hazmat</span></code> package and then it is meant to be use as a developer friendly approach to symmetric encryption.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from cryptography.fernet import Fernet
</pre></div>
</div>
</div>
</div>
<section id="id5">
<h3>Encrypting<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>message = b&quot;Hello World!&quot;

key = Fernet.generate_key()

cipher = Fernet(key)

message_encrypted = cipher.encrypt(message)

print(f&quot;Secret Key: {key.hex()}&quot;)
print(f&quot;Encrypted Message: {message_encrypted.hex()}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Secret Key: 71565a4d76667432454c48785973307263344e75616c487a7169317258435770692d6575783731526b5a453d
Encrypted Message: 674141414141426a6a4d576c5f4b754c325f37624d73475953524e6e5965676b496f6449714d71396e55666136616e6d42534f6245734e51796672597043386a386e6b46436e7434696a566656353957636e394e7172746f4a63414c63316d7942673d3d
</pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h3>Decrypting<a class="headerlink" href="#id6" title="Permalink to this headline">#</a></h3>
<section id="id7">
<h4>Wrong Key<a class="headerlink" href="#id7" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>guess_password = bytes.fromhex(&quot;785754746c6136366d4f467431395543336c46444c71692d3249792d5a365374386665566f64726f4639303d&quot;)

cipher = Fernet(guess_password)

try:
    message_decrypted = cipher.decrypt(message_encrypted)
    print(f&quot;Encrypted Message: {message_decrypted}&quot;)
except cryptography.fernet.InvalidToken:
    print(&quot;Token Invalid&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Token Invalid
</pre></div>
</div>
</div>
</div>
</section>
<section id="id8">
<h4>Right Key<a class="headerlink" href="#id8" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cipher = Fernet(key)

try:
    message_decrypted = cipher.decrypt(message_encrypted)
    print(f&quot;Encrypted Message: {message_decrypted}&quot;)
except cryptography.fernet.InvalidToken:
    print(&quot;Token Invalid&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Encrypted Message: b&#39;Hello World!&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion">
<h3>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">#</a></h3>
<p>Symmetric encryption provides a way to hide the original information in a reversible way. When using authenticated algorithms, if the encrypted message is modified, when decrypted, the output will be have no sense. Authenticated algorithms can detect changes and throw errors. There are many implementations of symmetric algorithms, many are low-level like AES but are more cross-platform whereas other such as Fernet have a more user-friendly approach but are only avaiable in certain programming languages.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "ELC/python-security",
            ref: "source",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="05_HMAC.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">HMAC</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="07_Asymmetric_Encryption.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Asymmetric Encryption</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Ezequiel Leonardo Castaño<br/>
  
      &copy; Copyright 2021, Ezequiel Leonardo Castaño.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>